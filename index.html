<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An R script to find complex areas for the Streets4All Project • SiteSelection</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An R script to find complex areas for the Streets4All Project">
<meta name="description" content="SiteSelection aims to find areas for a dynamic street re-allocation experiment. It consist in a process of multi criteria to select the cell locations of a giver city or neighborhood where the street space is more disputed by different transport modes and street activities. SiteSelection is a full script that uses a dynamic pipeline, by using targets R package.">
<meta property="og:description" content="SiteSelection aims to find areas for a dynamic street re-allocation experiment. It consist in a process of multi criteria to select the cell locations of a giver city or neighborhood where the street space is more disputed by different transport modes and street activities. SiteSelection is a full script that uses a dynamic pipeline, by using targets R package.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">SiteSelection</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/U-Shift/SiteSelection/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="siteselection">SiteSelection<a class="anchor" aria-label="anchor" href="#siteselection"></a>
</h1></div>
<p><strong>SiteSelection</strong> aims to find complex zones to reallocate street space in the city, characterized by having limited and disputed spaces. These zones are also areas that have the potential for reallocating space dynamically over time, especially when multimodal demands are complementary.</p>
<p>It consists in a process of multi criteria to select the cell locations of a given city or neighbourhood where the street space is more disputed by different transport modes and street activities.</p>
<p>SiteSelection is a full script that uses a dynamic pipeline, and gathers and processes information on:</p>
<ul>
<li>Road network centrality measures (betweenness, closeness, degree)</li>
<li>Population density</li>
<li>POI and activities</li>
<li>Public Transit Frequency</li>
<li>Traffic levels (<em>TBC</em>)</li>
</ul>
<div class="section level2">
<h2 id="sources">Sources<a class="anchor" aria-label="anchor" href="#sources"></a>
</h2>
<p>The SiteSelection package is based in Portuguese open datasets, such as census and GTFS data.</p>
<p>Although it is easy to run for any location in Portugal, you may adapt the code to run at other locations (considering you have the similar data needed).</p>
<p>Data needed for other locations:</p>
<ul>
<li>Census data (population and buildings)</li>
<li>POIs (see <a href="https://github.com/U-Shift/SiteSelection/blob/fc0bce07acf3b60ce0bfe1d26511acd7c2d5c083/code/data_extract.R#L146" class="external-link">data_extract.R</a>)</li>
<li>GTFS data (see <a href="https://github.com/U-Shift/SiteSelection/blob/main/code/transit.R" class="external-link">transit.R</a>)</li>
<li>Administrative boundaries</li>
</ul>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"u-shift/SiteSelection"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h3>
<ul>
<li>QGis and <a href="https://r-spatial.github.io/qgisprocess/" class="external-link"><code>qgis_process</code></a> installed and working</li>
<li>
<a href="https://books.ropensci.org/targets/" class="external-link"><code>targets</code></a> R package.</li>
<li>
<a href=""><code>siteselection</code></a> R package [<em>under development</em>].</li>
</ul>
</div>
<div class="section level3">
<h3 id="change-defaults">Change defaults<a class="anchor" aria-label="anchor" href="#change-defaults"></a>
</h3>
<p>Open the <code>_targets.R</code> file and change the defaults to your needs (don’t forget to save the file before run!):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set defaults HERE ######################</span></span>
<span><span class="va">CITY_input</span> <span class="op">=</span> <span class="st">"Lisboa"</span>       <span class="co"># Municipality name in Portugal</span></span>
<span><span class="va">GEOJSON</span> <span class="op">=</span> <span class="cn">FALSE</span>             <span class="co"># use a different limit? made with https://geojson.io/ and saved in inputdata/*.geojson</span></span>
<span><span class="va">GEOJSON_input</span> <span class="op">=</span> <span class="st">"map1"</span>      <span class="co"># name of the file if GEOJSON = TRUE. default: "map1"</span></span>
<span><span class="va">cellsize_input</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">600</span>, <span class="fl">600</span><span class="op">)</span><span class="co"># in meters</span></span>
<span><span class="va">square_input</span> <span class="op">=</span> <span class="cn">TRUE</span>         <span class="co"># TRUE = squares, FALSE = hexagons</span></span>
<span><span class="va">use_h3</span> <span class="op">=</span> <span class="cn">FALSE</span>              <span class="co"># use h3 to create universal grid?</span></span>
<span><span class="va">h3_res</span> <span class="op">=</span> <span class="fl">8</span>                  <span class="co"># h3 resolution. default: 9 (400m diameter). 8 = 1060m diameter, 10 = 150m diameter</span></span>
<span><span class="va">build_osm</span> <span class="op">=</span> <span class="cn">FALSE</span>           <span class="co"># download and clean osm road network again?</span></span>
<span><span class="va">analysis</span> <span class="op">=</span> <span class="cn">TRUE</span>            <span class="co"># export input parameters and results to a xls file? default: FALSE</span></span>
<span></span>
<span><span class="co"># Thresholds for candidate selection</span></span>
<span><span class="va">population_min</span> <span class="op">=</span> <span class="va">median</span>     <span class="co"># mean or median? default: mean</span></span>
<span><span class="va">degree_min</span> <span class="op">=</span> <span class="va">mean</span>           <span class="co"># mean or median? default: mean</span></span>
<span><span class="va">betweeness_range</span> <span class="op">=</span> <span class="fl">0.40</span>     <span class="co"># percentile to exclude (upper and lower) default: 0.25</span></span>
<span><span class="va">closeness_range</span> <span class="op">=</span> <span class="fl">0.25</span>      <span class="co"># value to exclude (upper and lower) default: 0.25</span></span>
<span><span class="va">entropy_min</span> <span class="op">=</span> <span class="fl">0.35</span>          <span class="co"># value to exclude (lower) default: 0.5</span></span>
<span><span class="va">freq_bus</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>     <span class="co"># frequency of bus stops to define classification. last 2 will remain. default: c(4, 10, 20) </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-the-pipeline">Run the pipeline<a class="anchor" aria-label="anchor" href="#run-the-pipeline"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span>targets_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># or false, to show objects</span></span></code></pre></div>
<p>And you should have something like this</p>
<p><img src="reference/figures/tar_viz_run.png" width="1767"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># let it run</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_load.html" class="external-link">tar_load</a></span><span class="op">(</span><span class="va">grid_all</span><span class="op">)</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">grid_all</span>, zcol<span class="op">=</span><span class="st">"score"</span><span class="op">)</span> <span class="co">#ranked cells</span></span></code></pre></div>
<p><img src="reference/figures/tar_result.png" width="629"></p>
<p>If you want to see the filtered cells (candidates), you can load the <code>site_selection</code> object and plot it, with <em>complex</em> and <em>very complex</em> cells (transit layer considered).</p>
<p><img src="reference/figures/complexity.png" width="660"></p>
<p>When the process is not complete, you may have an error like this</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/tar_viz_werror.png" width="689"></p>
</div>
<div class="section level3">
<h3 id="work-with-other-cities">Work with other cities<a class="anchor" aria-label="anchor" href="#work-with-other-cities"></a>
</h3>
<p>You can change the city to any other in Portugal.</p>
<p><em>Other locations are work in Progress…</em></p>
</div>
<div class="section level3">
<h3 id="work-with-non-administrative-boundary">Work with non-administrative boundary<a class="anchor" aria-label="anchor" href="#work-with-non-administrative-boundary"></a>
</h3>
<p>You can set another polygon limit to the analysis.<br>
Just <a href="https://geojson.io/" class="external-link">create a .geojson file</a> with the area of interest and save it in the <code>inputdata</code> folder.<br>
Then, set the <code>GEOJSON = TRUE</code> and <code>GEOJSON_input</code> to the name of the file, without the extension.</p>
</div>
<div class="section level3">
<h3 id="use-other-grids">Use other grids<a class="anchor" aria-label="anchor" href="#use-other-grids"></a>
</h3>
<p>By default, the grid is created with squares. You can change it to hexagons by setting <code>square_input = FALSE</code> in <code>_targets.R</code>.</p>
<p><img src="images/clipboard-3306234436.png" width="188"></p>
<p>You can also use the universal <a href="https://h3geo.org/" class="external-link">h3 hexagon grid</a> by setting <code>use_h3 = TRUE</code> and changing the resolution in <code>h3_res</code>.</p>
</div>
<div class="section level3">
<h3 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h3>
<p>If you want to analyze the results in detail, set <code>analysis = TRUE</code> in <code>_targets.R</code> and load the <code>analysis/analysis.table.Rds</code> or <code>.xlsx</code>. It includes sequential runs with all inputs, outputs, and variable statistics.</p>
</div>
</div>
<div class="section level2">
<h2 id="about">About<a class="anchor" aria-label="anchor" href="#about"></a>
</h2>
<div class="section level3">
<h3 id="project">Project<a class="anchor" aria-label="anchor" href="#project"></a>
</h3>
<p>This work is part of <a href="https://streets4all.tecnico.ulisboa.pt" class="external-link">Streets4All Project</a>, developed at the University of Lisbon and at the University of Coimbra, and funded by Fundação para a Ciência e Tecnologia (PT).</p>
<p>The concept is based in:<br>
Valença, G., Moura, F., &amp; Morais de Sá, A. (2024). Where is it complex to reallocate road space? <em>Environment and Planning B: Urban Analytics and City Science</em>, 51(6). <a href="https://doi.org/10.1177/23998083231217770" class="external-link uri">https://doi.org/10.1177/23998083231217770</a>.</p>
</div>
<div class="section level3">
<h3 id="presentation">Presentation<a class="anchor" aria-label="anchor" href="#presentation"></a>
</h3>
<p>This work was presented at the <a href="https://www.getransportes.org/" class="external-link">GET 2025 conference</a>, January 2025.<br><strong>Slides</strong>: <a href="https://u-shift.github.io/SiteSelection/slides" class="uri">https://u-shift.github.io/SiteSelection/slides</a></p>
</div>
<div class="section level3">
<h3 id="cite">Cite<a class="anchor" aria-label="anchor" href="#cite"></a>
</h3>
<p>Please refer to this work as:<br>
Félix R, Valença G (2024). <em>SiteSelection: An R script to find complex areas for the Streets4All Project</em>. R package version 0.2, <a href="https://github.com/U-Shift/SiteSelection/" class="external-link uri">https://github.com/U-Shift/SiteSelection/</a>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/U-Shift/SiteSelection/" class="external-link">Browse source code</a></li>
<li><a href="https://streets4all.tecnico.ulisboa.pt" class="external-link">Streets4All</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing SiteSelection</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Rosa Félix <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-5642-6006" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Gabriel Valença <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-3684-3005" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rosa Félix, Gabriel Valença.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
